<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">     * 训练目录下的样本集合</span>
<span class="cm">     * </span>
<span class="cm">     * @throws IOException</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">trainSamples</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">NaiveBayes</span> <span class="n">classifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NaiveBayes</span><span class="o">();</span>
        <span class="n">File</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;./data-trainning-set&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">File</span> <span class="n">f</span> <span class="o">:</span> <span class="n">flist</span><span class="o">.</span><span class="na">listFiles</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">classifier</span><span class="o">.</span><span class="na">training</span><span class="o">(</span><span class="k">new</span> <span class="n">Instance</span><span class="o">(</span><span class="n">f</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">classifier</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;result.dat&quot;</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Trainning finished&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * specify the training dataset directory, and store result in the outfile</span>
<span class="cm">     * </span>
<span class="cm">     * @param directory</span>
<span class="cm">     * @param result</span>
<span class="cm">     * @throws IOException</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">trainSamples</span><span class="o">(</span><span class="n">String</span> <span class="n">directory</span><span class="o">,</span> <span class="n">String</span> <span class="n">outfile</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">NaiveBayes</span> <span class="n">classifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NaiveBayes</span><span class="o">();</span>
        <span class="n">File</span> <span class="n">flist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">directory</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">File</span> <span class="n">f</span> <span class="o">:</span> <span class="n">flist</span><span class="o">.</span><span class="na">listFiles</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">classifier</span><span class="o">.</span><span class="na">training</span><span class="o">(</span><span class="k">new</span> <span class="n">Instance</span><span class="o">(</span><span class="n">f</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">classifier</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">outfile</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Trainning finished&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 判断该实例所属的类别category</span>
<span class="cm">     * </span>
<span class="cm">     * @param doc</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCategory</span><span class="o">(</span><span class="n">Instance</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">VARIABLE</span><span class="o">.</span><span class="na">getCategories</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">categories</span><span class="o">);</span>
        <span class="kt">double</span> <span class="n">best</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">NEGATIVE_INFINITY</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">bestName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">c</span> <span class="o">:</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">double</span> <span class="n">current</span> <span class="o">=</span> <span class="n">getProbability</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">doc</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">current</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">best</span> <span class="o">&lt;</span> <span class="n">current</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">best</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
                <span class="n">bestName</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bestName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 计算P（C)=该类型文档总数/文档总数，返回的数对数值</span>
<span class="cm">     * </span>
<span class="cm">     * @param category</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getCategoryProbability</span><span class="o">(</span><span class="n">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">VARIABLE</span><span class="o">.</span><span class="na">getDocCount</span><span class="o">(</span><span class="n">category</span><span class="o">)</span> <span class="o">*</span> <span class="mf">1.0f</span>
                <span class="o">/</span> <span class="n">VARIABLE</span><span class="o">.</span><span class="na">getDocCount</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 计算P(feature|cateogry),返回的是取对数后的数值</span>
<span class="cm">     * </span>
<span class="cm">     * @param feature</span>
<span class="cm">     * @param category</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getFeatureProbability</span><span class="o">(</span><span class="n">String</span> <span class="n">feature</span><span class="o">,</span> <span class="n">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">VARIABLE</span><span class="o">.</span><span class="na">getFeatureCount</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">((</span><span class="n">VARIABLE</span><span class="o">.</span><span class="na">getDocCount</span><span class="o">(</span><span class="n">feature</span><span class="o">,</span> <span class="n">category</span><span class="o">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">)</span>
                <span class="o">/</span> <span class="o">(</span><span class="n">VARIABLE</span><span class="o">.</span><span class="na">getDocCount</span><span class="o">(</span><span class="n">category</span><span class="o">)</span> <span class="o">+</span> <span class="n">m</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 计算给定实例文档属于指定类别的概率，返回的是取对数后的数值</span>
<span class="cm">     * </span>
<span class="cm">     * @param category</span>
<span class="cm">     * @param doc</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getProbability</span><span class="o">(</span><span class="n">String</span> <span class="n">category</span><span class="o">,</span> <span class="n">Instance</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getCategoryProbability</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">feature</span> <span class="o">:</span> <span class="n">doc</span><span class="o">.</span><span class="na">getWords</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">VARIABLE</span><span class="o">.</span><span class="na">containFeature</span><span class="o">(</span><span class="n">feature</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">getFeatureProbability</span><span class="o">(</span><span class="n">feature</span><span class="o">,</span> <span class="n">category</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 加载训练结果</span>
<span class="cm">     * </span>
<span class="cm">     * @param file</span>
<span class="cm">     * @throws IOException</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">DataInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
        <span class="n">VARIABLE</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 保存训练结果</span>
<span class="cm">     * </span>
<span class="cm">     * @throws IOException</span>
<span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">DataOutput</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
        <span class="n">VARIABLE</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 训练一篇文档</span>
<span class="cm">     * </span>
<span class="cm">     * @param doc</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">training</span><span class="o">(</span><span class="n">Instance</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">VARIABLE</span><span class="o">.</span><span class="na">addInstance</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>